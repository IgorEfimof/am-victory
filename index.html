<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Теннисный анализатор</title>
    <style>
        /* Компактные стили для iPad */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, sans-serif;
            padding: 5px;
            background: #2c2c2e;
            color: #fff;
            -webkit-text-size-adjust: none;
            touch-action: pan-y;
            font-size: 12px;
            line-height: 1.2;
        }
        .container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            background: #1c1c1e;
            padding: 8px;
            border-radius: 6px;
            padding-bottom: 50px;
        }
        h1 {
            color: #007aff;
            font-size: 15px;
            margin: 0 0 5px;
            padding-bottom: 4px;
            border-bottom: 1px solid #007aff;
        }
        h2 {
            color: #007aff;
            font-size: 13px;
            margin: 8px 0 4px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 5px 0;
            font-size: 11px;
        }
        th {
            background: #007aff;
            color: white;
            padding: 4px 2px;
            text-align: center;
            font-weight: bold;
        }
        td {
            padding: 4px 2px;
            border: 1px solid #3a3a3c;
            text-align: center;
            height: 28px;
        }
        tr:nth-child(even) { background: #2c2c2e; }
        .coeff-input {
            width: 48px;
            padding: 3px;
            border: 1px solid #3a3a3c;
            border-radius: 3px;
            text-align: center;
            background: #2c2c2e;
            color: white;
            font-size: 11px;
            height: 22px;
        }
        .trend-up { color: #34c759; font-weight: bold; }
        .trend-down { color: #ff3b30; font-weight: bold; }
        .trend-neutral { color: #ffcc00; }
        .summary-box {
            background: #2c2c2e;
            padding: 6px;
            border-radius: 4px;
            margin: 8px 0;
            font-size: 11px;
        }
        .summary-item {
            margin-bottom: 4px;
        }
        .summary-item span {
            font-weight: bold;
            color: #007aff;
        }
        .clear-button {
            background: #007aff;
            color: white;
            border: none;
            padding: 6px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 6px;
            font-weight: bold;
            font-size: 12px;
            width: 100%;
            height: 30px;
        }
        .importance {
            color: #ffcc00;
            font-size: 10px;
        }
        .virtual-keyboard {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #2c2c2e;
            padding: 5px;
            border-top: 1px solid #3a3a3c;
            z-index: 1000;
            display: none;
        }
        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 3px;
        }
        .key {
            background: #3a3a3c;
            color: white;
            border: none;
            border-radius: 3px;
            width: 14%;
            max-width: 45px;
            height: 32px;
            margin: 0 1px;
            font-size: 13px;
            cursor: pointer;
        }
        .key-done {
            background: #007aff;
            color: white;
            border: none;
            border-radius: 3px;
            height: 32px;
            padding: 0 10px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 3px;
        }
        .player-analysis {
            margin: 6px 0;
            padding: 5px;
            background: #252528;
            border-radius: 3px;
            font-size: 11px;
        }
        .progress-container {
            margin: 4px 0;
        }
        .progress-bar {
            height: 6px;
            background: #3a3a3c;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 3px;
        }
        .progress-fill.player1 { background: #34c759; }
        .progress-fill.player2 { background: #007aff; }
        .game-period {
            display: flex;
            justify-content: space-between;
            margin-top: 4px;
            padding-top: 3px;
            border-top: 1px dashed #3a3a3c;
        }
        .game-period span { display: inline-block; width: 48%; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Теннисный анализатор</h1>
        
        <!-- Прематч коэффициенты -->
        <h2>Прематч</h2>
        <table>
            <tr>
                <th>Игрок 1</th>
                <th>Игрок 2</th>
            </tr>
            <tr>
                <td><input type="text" id="prematchPlayer1" class="coeff-input" placeholder="1.50" readonly></td>
                <td><input type="text" id="prematchPlayer2" class="coeff-input" placeholder="2.50" readonly></td>
            </tr>
        </table>
        
        <!-- Лайв коэффициенты -->
        <h2>Лайв</h2>
        <table>
            <thead>
                <tr>
                    <th>Гейм</th>
                    <th>Игрок 1</th>
                    <th>Игрок 2</th>
                    <th>Тренд</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>5</td>
                    <td><input type="text" class="coeff-input live-input" data-game="5" data-player="1" placeholder="1.96" readonly></td>
                    <td><input type="text" class="coeff-input live-input" data-game="5" data-player="2" placeholder="1.75" readonly></td>
                    <td class="game-trend">-</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td><input type="text" class="coeff-input live-input" data-game="6" data-player="1" placeholder="1.85" readonly></td>
                    <td><input type="text" class="coeff-input live-input" data-game="6" data-player="2" placeholder="1.85" readonly></td>
                    <td class="game-trend">-</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td><input type="text" class="coeff-input live-input" data-game="7" data-player="1" placeholder="1.90" readonly></td>
                    <td><input type="text" class="coeff-input live-input" data-game="7" data-player="2" placeholder="1.80" readonly></td>
                    <td class="game-trend">-</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td><input type="text" class="coeff-input live-input" data-game="8" data-player="1" placeholder="1.95" readonly></td>
                    <td><input type="text" class="coeff-input live-input" data-game="8" data-player="2" placeholder="1.75" readonly></td>
                    <td class="game-trend">-</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td><input type="text" class="coeff-input live-input" data-game="9" data-player="1" placeholder="2.00" readonly></td>
                    <td><input type="text" class="coeff-input live-input" data-game="9" data-player="2" placeholder="1.70" readonly></td>
                    <td class="game-trend">-</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td><input type="text" class="coeff-input live-input" data-game="10" data-player="1" placeholder="2.10" readonly></td>
                    <td><input type="text" class="coeff-input live-input" data-game="10" data-player="2" placeholder="1.65" readonly></td>
                    <td class="game-trend">-</td>
                </tr>
            </tbody>
        </table>
        
        <!-- Диагностика матча -->
        <div class="summary-box">
            <h2>Диагностика</h2>
            
            <div class="summary-item">
                Средняя сила: 
                <span id="avgStrength1">0.00</span> (И1) | 
                <span id="avgStrength2">0.00</span> (И2)
            </div>
            
            <div class="player-analysis">
                <div><strong>Игрок 1</strong>: <span id="player1Strength">0.00</span></div>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill player1" id="player1Progress" style="width:0%"></div>
                    </div>
                </div>
                <div class="game-period">
                    <span>5-7: <span id="player1FirstHalf">0.00</span></span>
                    <span>8-10: <span id="player1SecondHalf">0.00</span></span>
                </div>
            </div>
            
            <div class="player-analysis">
                <div><strong>Игрок 2</strong>: <span id="player2Strength">0.00</span></div>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill player2" id="player2Progress" style="width:0%"></div>
                    </div>
                </div>
                <div class="game-period">
                    <span>5-7: <span id="player2FirstHalf">0.00</span></span>
                    <span>8-10: <span id="player2SecondHalf">0.00</span></span>
                </div>
            </div>
            
            <div class="summary-item">
                Прогноз: <span id="winnerPrediction">-</span>
            </div>
            
            <div class="summary-item">
                Вероятность: 
                <span id="winProbability1">50%</span> (И1) | 
                <span id="winProbability2">50%</span> (И2)
            </div>
            
            <div class="summary-item">
                Рекомендация: <span id="matchRecommendation">-</span>
            </div>
        </div>
        
        <!-- Сила геймов -->
        <h2>Сила геймов</h2>
        <table>
            <thead>
                <tr>
                    <th>Гейм</th>
                    <th>Игрок 1</th>
                    <th>Игрок 2</th>
                    <th>Важность</th>
                </tr>
            </thead>
            <tbody id="strengthTableBody">
                <tr>
                    <td>5</td>
                    <td id="strength5-1">0.00</td>
                    <td id="strength5-2">0.00</td>
                    <td class="importance">★☆☆☆☆</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td id="strength6-1">0.00</td>
                    <td id="strength6-2">0.00</td>
                    <td class="importance">★☆☆☆☆</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td id="strength7-1">0.00</td>
                    <td id="strength7-2">0.00</td>
                    <td class="importance">★★☆☆☆</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td id="strength8-1">0.00</td>
                    <td id="strength8-2">0.00</td>
                    <td class="importance">★★★☆☆</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td id="strength9-1">0.00</td>
                    <td id="strength9-2">0.00</td>
                    <td class="importance">★★★★☆</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td id="strength10-1">0.00</td>
                    <td id="strength10-2">0.00</td>
                    <td class="importance">★★★★★</td>
                </tr>
            </tbody>
        </table>
        
        <button id="clearButton" class="clear-button">Очистить данные</button>
    </div>

    <!-- Виртуальная клавиатура -->
    <div id="virtualKeyboard" class="virtual-keyboard">
        <div class="keyboard-row">
            <button class="key" data-value="1">1</button>
            <button class="key" data-value="2">2</button>
            <button class="key" data-value="3">3</button>
        </div>
        <div class="keyboard-row">
            <button class="key" data-value="4">4</button>
            <button class="key" data-value="5">5</button>
            <button class="key" data-value="6">6</button>
        </div>
        <div class="keyboard-row">
            <button class="key" data-value="7">7</button>
            <button class="key" data-value="8">8</button>
            <button class="key" data-value="9">9</button>
        </div>
        <div class="keyboard-row">
            <button class="key" data-value=".">.</button>
            <button class="key" data-value="0">0</button>
            <button class="key" data-value="backspace">⌫</button>
        </div>
        <div class="keyboard-row">
            <button class="key-done" data-value="done">Готово</button>
        </div>
    </div>

    <script>
        // Полная версия скрипта с сохранением всех функций
        document.addEventListener('DOMContentLoaded', function() {
            const keyboard = document.getElementById('virtualKeyboard');
            let activeInput = null;
            const gameData = {
                prematch: { player1: null, player2: null },
                live: Array.from({length: 6}, () => ({ player1: null, player2: null })),
                history: []
            };

            // Инициализация обработчиков ввода
            function initInputHandlers() {
                document.querySelectorAll('.coeff-input').forEach(input => {
                    input.addEventListener('focus', function(e) {
                        e.preventDefault();
                        activeInput = this;
                        keyboard.style.display = 'block';
                    });
                    
                    input.addEventListener('input', function() {
                        updateGameData();
                        updateCalculations();
                    });
                });
            }

            // Инициализация клавиатуры
            function initKeyboard() {
                document.querySelectorAll('.key, .key-done').forEach(button => {
                    button.addEventListener('click', function() {
                        const value = this.dataset.value;
                        
                        if (value === 'backspace') {
                            activeInput.value = activeInput.value.slice(0, -1);
                        } else if (value === 'done') {
                            keyboard.style.display = 'none';
                            if (activeInput) activeInput.blur();
                            activeInput = null;
                        } else {
                            handleInputValue(value);
                        }
                        
                        updateGameData();
                        updateCalculations();
                    });
                });
            }

            // Обработка ввода значений
            function handleInputValue(value) {
                let currentValue = activeInput.value;
                
                if (currentValue.length === 1 && !currentValue.includes('.')) {
                    activeInput.value = currentValue + '.' + value;
                } else if (currentValue.length < 4) {
                    activeInput.value += value;
                }
                
                if (activeInput.value.length === 4) {
                    moveToNextInput();
                }
            }

            // Переход к следующему полю ввода
            function moveToNextInput() {
                const allInputs = Array.from(document.querySelectorAll('.coeff-input'));
                const currentIndex = allInputs.indexOf(activeInput);
                
                if (currentIndex < allInputs.length - 1) {
                    allInputs[currentIndex + 1].focus();
                } else {
                    keyboard.style.display = 'none';
                    activeInput.blur();
                    activeInput = null;
                }
            }

            // Обновление данных игры
            function updateGameData() {
                // Прематч коэффициенты
                gameData.prematch.player1 = parseFloat(document.getElementById('prematchPlayer1').value) || null;
                gameData.prematch.player2 = parseFloat(document.getElementById('prematchPlayer2').value) || null;
                
                // Лайв коэффициенты
                for (let i = 5; i <= 10; i++) {
                    const idx = i - 5;
                    gameData.live[idx].player1 = parseFloat(
                        document.querySelector(`.live-input[data-game="${i}"][data-player="1"]`).value
                    ) || null;
                    gameData.live[idx].player2 = parseFloat(
                        document.querySelector(`.live-input[data-game="${i}"][data-player="2"]`).value
                    ) || null;
                }
                
                // Сохраняем историю изменений для анализа трендов
                if (gameData.live.some(game => game.player1 && game.player2)) {
                    gameData.history.push({
                        time: new Date(),
                        data: JSON.parse(JSON.stringify(gameData.live))
                    });
                    
                    if (gameData.history.length > 5) {
                        gameData.history.shift();
                    }
                }
            }

            // Основные расчеты
            function updateCalculations() {
                updateGameData();
                
                // 1. Расчет силы геймов и трендов
                calculateGameStrengths();
                
                // 2. Расчет средней силы и прогноза
                calculateAverageStrengths();
                
                // 3. Анализ игроков
                analyzePlayers();
                
                // 4. Расчет вероятностей
                calculateProbabilities();
            }

            // Расчет силы геймов и трендов
            function calculateGameStrengths() {
                for (let i = 5; i <= 10; i++) {
                    const idx = i - 5;
                    const p1 = gameData.live[idx].player1;
                    const p2 = gameData.live[idx].player2;
                    
                    if (p1 && p2) {
                        // Сила = (1/коэффициент) * 100
                        const strength1 = (1/p1 * 100).toFixed(2);
                        const strength2 = (1/p2 * 100).toFixed(2);
                        
                        document.getElementById(`strength${i}-1`).textContent = strength1;
                        document.getElementById(`strength${i}-2`).textContent = strength2;
                        
                        // Расчет тренда (сравнение с предыдущим геймом)
                        if (idx > 0 && gameData.live[idx-1].player1 && gameData.live[idx-1].player2) {
                            const prev1 = gameData.live[idx-1].player1;
                            const prev2 = gameData.live[idx-1].player2;
                            
                            const trend1 = p1 < prev1 ? '↑' : p1 > prev1 ? '↓' : '→';
                            const trend2 = p2 < prev2 ? '↑' : p2 > prev2 ? '↓' : '→';
                            
                            const trendElement = document.querySelector(`.live-input[data-game="${i}"][data-player="1"]`)
                                .parentNode.nextElementSibling.nextElementSibling;
                            
                            trendElement.innerHTML = `
                                <span class="${trend1 === '↑' ? 'trend-up' : trend1 === '↓' ? 'trend-down' : 'trend-neutral'}">1${trend1}</span>
                                <span class="${trend2 === '↑' ? 'trend-up' : trend2 === '↓' ? 'trend-down' : 'trend-neutral'}">2${trend2}</span>
                            `;
                        }
                    }
                }
            }

            // Расчет средней силы
            function calculateAverageStrengths() {
                let totalStrength1 = 0, totalStrength2 = 0;
                let firstHalf1 = 0, firstHalf2 = 0;
                let secondHalf1 = 0, secondHalf2 = 0;
                let count = 0, countFirst = 0, countSecond = 0;
                
                for (let i = 5; i <= 10; i++) {
                    const idx = i - 5;
                    if (gameData.live[idx].player1 && gameData.live[idx].player2) {
                        const strength1 = 1/gameData.live[idx].player1;
                        const strength2 = 1/gameData.live[idx].player2;
                        
                        totalStrength1 += strength1;
                        totalStrength2 += strength2;
                        count++;
                        
                        // Разделение на первую и вторую половину
                        if (i <= 7) {
                            firstHalf1 += strength1;
                            firstHalf2 += strength2;
                            countFirst++;
                        } else {
                            secondHalf1 += strength1;
                            secondHalf2 += strength2;
                            countSecond++;
                        }
                    }
                }
                
                if (count > 0) {
                    const avgStrength1 = (totalStrength1/count * 100).toFixed(2);
                    const avgStrength2 = (totalStrength2/count * 100).toFixed(2);
                    
                    // Обновление средних значений
                    document.getElementById('avgStrength1').textContent = avgStrength1;
                    document.getElementById('avgStrength2').textContent = avgStrength2;
                    document.getElementById('player1Strength').textContent = avgStrength1;
                    document.getElementById('player2Strength').textContent = avgStrength2;
                    
                    // Обновление прогресс-баров
                    document.getElementById('player1Progress').style.width = `${Math.min(100, avgStrength1)}%`;
                    document.getElementById('player2Progress').style.width = `${Math.min(100, avgStrength2)}%`;
                    
                    // Обновление значений по половинам
                    if (countFirst > 0) {
                        document.getElementById('player1FirstHalf').textContent = (firstHalf1/countFirst * 100).toFixed(2);
                        document.getElementById('player2FirstHalf').textContent = (firstHalf2/countFirst * 100).toFixed(2);
                    }
                    
                    if (countSecond > 0) {
                        document.getElementById('player1SecondHalf').textContent = (secondHalf1/countSecond * 100).toFixed(2);
                        document.getElementById('player2SecondHalf').textContent = (secondHalf2/countSecond * 100).toFixed(2);
                    }
                }
            }

            // Анализ игроков
            function analyzePlayers() {
                const strength1 = parseFloat(document.getElementById('avgStrength1').textContent) || 0;
                const strength2 = parseFloat(document.getElementById('avgStrength2').textContent) || 0;
                
                // Анализ формы игроков
                const form1 = analyzePlayerForm(1, strength1);
                const form2 = analyzePlayerForm(2, strength2);
                
                // Прогноз победителя
                if (strength1 > strength2) {
                    document.getElementById('winnerPrediction').textContent = 'Игрок 1';
                    document.getElementById('matchRecommendation').textContent = form1.recommendation;
                } else if (strength2 > strength1) {
                    document.getElementById('winnerPrediction').textContent = 'Игрок 2';
                    document.getElementById('matchRecommendation').textContent = form2.recommendation;
                } else {
                    document.getElementById('winnerPrediction').textContent = 'Не определен';
                    document.getElementById('matchRecommendation').textContent = 'Не рекомендуется';
                }
            }

            // Анализ формы конкретного игрока
            function analyzePlayerForm(playerNum, strength) {
                let form = '', recommendation = '';
                
                if (strength > 70) {
                    form = 'Отличная форма';
                    recommendation = playerNum === 1 ? 'Сильная ставка на Игрока 1' : 'Сильная ставка на Игрока 2';
                } else if (strength > 55) {
                    form = 'Хорошая форма';
                    recommendation = playerNum === 1 ? 'Ставка на Игрока 1' : 'Ставка на Игрока 2';
                } else if (strength > 40) {
                    form = 'Средняя форма';
                    recommendation = playerNum === 1 ? 'Осторожная ставка на Игрока 1' : 'Осторожная ставка на Игрока 2';
                } else {
                    form = 'Слабая форма';
                    recommendation = playerNum === 1 ? 'Избегайте ставок на Игрока 1' : 'Избегайте ставок на Игрока 2';
                }
                
                // Анализ тренда
                if (gameData.history.length > 1) {
                    const lastGames = gameData.history.slice(-2);
                    const lastStrength1 = calculateAverageStrengthForHistory(lastGames[0].data, playerNum);
                    const lastStrength2 = calculateAverageStrengthForHistory(lastGames[1].data, playerNum);
                    
                    if (lastStrength2 > lastStrength1) {
                        form += ', улучшение';
                    } else if (lastStrength2 < lastStrength1) {
                        form += ', ухудшение';
                    } else {
                        form += ', стабильно';
                    }
                }
                
                return { form, recommendation };
            }

            // Расчет средней силы для истории
            function calculateAverageStrengthForHistory(historyData, playerNum) {
                let total = 0;
                let count = 0;
                
                for (let i = 0; i < historyData.length; i++) {
                    const coeff = historyData[i][`player${playerNum}`];
                    if (coeff) {
                        total += 1/coeff * 100;
                        count++;
                    }
                }
                
                return count > 0 ? total/count : 0;
            }

            // Расчет вероятностей
            function calculateProbabilities() {
                const strength1 = parseFloat(document.getElementById('avgStrength1').textContent) || 0;
                const strength2 = parseFloat(document.getElementById('avgStrength2').textContent) || 0;
                const total = strength1 + strength2;
                
                if (total > 0) {
                    const prob1 = (strength1/total * 100).toFixed(1);
                    const prob2 = (strength2/total * 100).toFixed(1);
                    
                    document.getElementById('winProbability1').textContent = `${prob1}%`;
                    document.getElementById('winProbability2').textContent = `${prob2}%`;
                }
            }

            // Очистка данных
            function clearData() {
                document.querySelectorAll('.coeff-input').forEach(input => input.value = '');
                document.querySelectorAll('.game-trend').forEach(el => el.textContent = '-');
                
                // Сброс значений силы
                document.querySelectorAll('#strengthTableBody td:not(:first-child):not(:last-child)').forEach(td => {
                    td.textContent = '0.00';
                });
                
                // Сброс диагностики
                document.getElementById('avgStrength1').textContent = '0.00';
                document.getElementById('avgStrength2').textContent = '0.00';
                document.getElementById('player1Strength').textContent = '0.00';
                document.getElementById('player2Strength').textContent = '0.00';
                document.getElementById('player1FirstHalf').textContent = '0.00';
                document.getElementById('player2FirstHalf').textContent = '0.00';
                document.getElementById('player1SecondHalf').textContent = '0.00';
                document.getElementById('player2SecondHalf').textContent = '0.00';
                
                document.getElementById('winnerPrediction').textContent = '-';
                document.getElementById('matchRecommendation').textContent = '-';
                document.getElementById('winProbability1').textContent = '50%';
                document.getElementById('winProbability2').textContent = '50%';
                
                document.getElementById('player1Progress').style.width = '0%';
                document.getElementById('player2Progress').style.width = '0%';
                
                // Сброс данных
                gameData.prematch = { player1: null, player2: null };
                gameData.live = Array.from({length: 6}, () => ({ player1: null, player2: null }));
                gameData.history = [];
            }

            // Инициализация
            function init() {
                initInputHandlers();
                initKeyboard();
                
                document.getElementById('clearButton').addEventListener('click', clearData);
                
                document.addEventListener('click', function(e) {
                    if (!e.target.classList.contains('coeff-input') && 
                        !e.target.classList.contains('key') && 
                        !e.target.classList.contains('key-done')) {
                        keyboard.style.display = 'none';
                        if (activeInput) activeInput.blur();
                        activeInput = null;
                    }
                });
            }

            init();
        });
    </script>
</body>
</html>
